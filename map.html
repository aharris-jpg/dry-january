<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dry January Completion Odds — U.S. Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- D3 + TopoJSON -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/topojson-client@3"></script>

  <style>
    :root{
      --bgTop:#f7f9fc;
      --bgBottom:#eef3f9;
      --ink:#0b2235;

      --accent:#2a5d7c;   /* same family as map blue */
--accent2:#1f475f;  /* darker for emphasis */

      /* ===== BLUE (harder) → ORANGE (easier) =====
         Keep ends distinct, keep mids soft, avoid neon.
      */
/* Harder to finish (blue → teal/steel) */
--hard0:#e8f1fb;
--hard1:#2a5d7c;

/* Easier to finish — muted amber (not yellow) */
/* Easier to finish — soft honey / apricot */
--easy0:#fff3df;   /* pale champagne */
--easy1:#d19a3a;   /* muted brushed gold */

      --card:rgba(255,255,255,0.85);
      --border:rgba(11,34,53,0.10);
      --shadow:0 16px 44px rgba(8,58,92,0.16);

      --font: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      --mono: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family:var(--font);
      color:var(--ink);
      padding:22px 14px 26px;
      background:linear-gradient(180deg,var(--bgTop),var(--bgBottom));
    }

    .wrap{ max-width:980px; margin:0 auto; }

    /* ===== HEADER ===== */
    .hero{ text-align:center; margin-bottom:12px; }
    .title{
      margin:0;
      font-weight:950;
      letter-spacing:.02em;
      font-size:clamp(26px,4vw,44px);
      text-transform:uppercase;
    }
    .title span{ color:var(--accent); }
    .subtitle{
      margin-top:6px;
      font-weight:800;
      color:rgba(11,34,53,.8);
      font-size:clamp(13px,1.7vw,16px);
    }

    /* ===== CARD ===== */
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    .map-frame{
      margin:14px;
      background:#fff;
      border-radius:16px;
      overflow:hidden;
    }
    svg{ width:100%; height:auto; display:block; }

    .state{
      stroke:#fff;
      stroke-width:6;
      cursor:pointer;
      transition:filter .12s ease;
    }
    .state:hover{
      filter: drop-shadow(0 0 10px rgba(11,34,53,0.22));
    }
    .state-outline{
      fill:none;
      stroke:rgba(11,34,53,.08);
      pointer-events:none;
    }

    /* ===== LEGEND ===== */
    .legend{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
      padding:10px 14px 6px;
    }
    .legend .label{
      font-size:12px;
      font-weight:900;
      text-transform:uppercase;
      color:rgba(11,34,53,.7);
      white-space:nowrap;
    }
    .legend .bar{
      position:relative;
      width:min(440px,78vw);
      height:14px;
      border-radius:999px;
      border:1px solid rgba(11,34,53,.12);
      /* Blue → neutral → Orange (diverging) */
      background:linear-gradient(
        90deg,
        var(--hard1) 0%,
        var(--hard0) 32%,
        #f5f5f5 50%,
        var(--easy0) 68%,
        var(--easy1) 100%
      );
    }
    .legend .bar:after{
      content:"";
      position:absolute;
      left:50%;
      top:-4px;
      width:2px;
      height:22px;
      background:rgba(11,34,53,.25);
      border-radius:2px;
    }
    .legend-note{
      text-align:center;
      font-size:11px;
      font-weight:800;
      color:rgba(11,34,53,.65);
      padding-bottom:10px;
    }

    /* ===== RANKING ===== */
    .rankwrap{ padding:0 14px 14px; }
    .rankhead{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      padding:10px 12px;
      background:rgba(255,255,255,.6);
      border:1px solid rgba(11,34,53,.1);
      border-radius:14px;
      margin-bottom:10px;
      gap:12px;
    }
    .ranktitle{
      font-size:12px;
      font-weight:950;
      text-transform:uppercase;
    }
    .ranksub{
      font-size:11px;
      font-weight:800;
      color:rgba(11,34,53,.6);
      margin-top:2px;
    }

    .rankcols{
      column-count:5;
      column-gap:12px;
      padding:10px 12px;
      background:rgba(255,255,255,.62);
      border:1px solid rgba(11,34,53,.1);
      border-radius:14px;
    }
    @media(max-width:1100px){.rankcols{column-count:4}}
    @media(max-width:860px){.rankcols{column-count:3}}
    @media(max-width:620px){.rankcols{column-count:2}}
    @media(max-width:420px){.rankcols{column-count:1}}

    .rankrow{
      break-inside:avoid;
      display:flex;
      align-items:center;
      gap:6px;
      font-size:10.3px;
      padding:2px 0;
      cursor:pointer;
    }
    .rankrow:hover .rname{ text-decoration:underline; }

    .rdot{
      width:7px;height:7px;border-radius:50%;
      flex:0 0 auto;
    }
    .rnum{
      width:22px;
      text-align:right;
      font-family:var(--mono);
      font-weight:900;
      color:rgba(11,34,53,.82);
      flex:0 0 auto;
    }
    .rname{
      font-weight:900;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      color:rgba(11,34,53,.92);
      min-width:0;
    }

    /* ===== TOOLTIP ===== */
    .tooltip{
      position:absolute;
      pointer-events:none;
      display:none;
      z-index:100;
      background:rgba(255,255,255,0.96);
      border:1px solid rgba(11,34,53,0.14);
      border-radius:14px;
      padding:10px 12px;
      box-shadow:0 18px 44px rgba(8,58,92,0.20);
      max-width:260px;
      backdrop-filter: blur(10px);
    }
    .tooltip strong{
      display:block;
      font-weight:950;
      margin-bottom:4px;
      color:rgba(11,34,53,0.92);
    }
    .tooltip .mono{
      font-family:var(--mono);
      font-variant-numeric:tabular-nums;
      font-weight:950;
      color:rgba(11,34,53,0.86);
    }
    .tooltip .muted{
      margin-top:4px;
      font-size:11px;
      color:rgba(11,34,53,0.62);
      font-weight:800;
    }

    /* ===== FOOTER ===== */
    .footer{
      padding:12px 14px;
      border-top:1px solid rgba(11,34,53,.1);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .source{
      font-size:12px;
      font-weight:900;
      text-transform:uppercase;
      color:rgba(11,34,53,.82);
    }
    .source a{
      color:var(--accent);
      text-decoration:none;
      border-bottom:1px dotted var(--accent);
      text-transform:none;
      font-weight:950;
    }
    .logo{ height:44px; }

    .method{
      padding:10px 14px 14px;
      font-size:11px;
      color:rgba(11,34,53,.65);
      border-top:1px solid rgba(11,34,53,.08);
      background:rgba(255,255,255,0.55);
      line-height:1.35;
    }
  </style>
</head>

<body>
<div class="wrap">

  <div class="hero">
    <h1 class="title"><span>DRY JANUARY</span> COMPLETION ODDS</h1>
    <div class="subtitle">Estimated chance of finishing Dry January (through Feb 1), by state</div>
  </div>

  <div class="card">

    <div class="map-frame">
      <svg id="map" viewBox="0 0 975 610" role="img" aria-label="Dry January Completion Odds map"></svg>
    </div>

    <div class="legend" aria-label="Legend">
      <div class="label">Harder to finish</div>
      <div class="bar" aria-hidden="true"></div>
      <div class="label">Easier to finish</div>
    </div>
    <div class="legend-note">
      <strong>Blue</strong> = harder to finish • <strong>Orange</strong> = easier to finish (darker = stronger)
    </div>

    <div class="rankwrap">
      <div class="rankhead">
        <div>
          <div class="ranktitle">State ranking (1 = most likely to finish)</div>
          <div class="ranksub">Click a state name to highlight it on the map</div>
        </div>
      </div>
      <div class="rankcols" id="rankcols" aria-label="All state ranks"></div>
    </div>

    <div class="footer">
      <div class="source">
        Source: Vegas Insider<br>
        <a href="https://www.vegasinsider.com" target="_blank" rel="noopener">vegasinsider.com</a>
      </div>
      <img class="logo" src="https://i.postimg.cc/65VDq2fP/download-2.png" alt="Vegas Insider logo">
    </div>

    <div class="method">
      <strong>Methodology:</strong> States are ranked using an odds-style model of Dry January completion conditions.
      Colors reflect implied completion probability (higher = easier).
      <br><br>
      <strong>Inputs:</strong> binge drinking, physical activity, smoking, January temperature, and non-drinker share (weighted).
    </div>

  </div>
</div>

<div class="tooltip" id="tt"></div>

<script>
const dryData = {
"Utah":{abbr:"UT",rank:1,prob:62.97},"Minnesota":{abbr:"MN",rank:2,prob:62.37},"Vermont":{abbr:"VT",rank:3,prob:57.92},
"Alaska":{abbr:"AK",rank:4,prob:55.67},"Wisconsin":{abbr:"WI",rank:5,prob:55.37},"Colorado":{abbr:"CO",rank:6,prob:54.86},
"New Hampshire":{abbr:"NH",rank:7,prob:53.93},"Washington":{abbr:"WA",rank:8,prob:52.32},
"Massachusetts":{abbr:"MA",rank:9,prob:51.44},"Connecticut":{abbr:"CT",rank:10,prob:51.08},
"Montana":{abbr:"MT",rank:11,prob:50.41},"Hawaii":{abbr:"HI",rank:12,prob:50.35},
"New York":{abbr:"NY",rank:13,prob:49.86},"Michigan":{abbr:"MI",rank:14,prob:49.42},
"North Dakota":{abbr:"ND",rank:15,prob:49.26},"Maine":{abbr:"ME",rank:16,prob:48.88},
"Maryland":{abbr:"MD",rank:17,prob:48.53},"Iowa":{abbr:"IA",rank:18,prob:48.35},
"California":{abbr:"CA",rank:19,prob:46.3},"Idaho":{abbr:"ID",rank:20,prob:45.85},
"Nebraska":{abbr:"NE",rank:21,prob:45.1},"Illinois":{abbr:"IL",rank:22,prob:44.48},
"Wyoming":{abbr:"WY",rank:23,prob:44.39},"South Dakota":{abbr:"SD",rank:24,prob:43.06},
"Oregon":{abbr:"OR",rank:25,prob:42.94},"Rhode Island":{abbr:"RI",rank:26,prob:42.37},
"Pennsylvania":{abbr:"PA",rank:27,prob:40.17},"Virginia":{abbr:"VA",rank:28,prob:39.14},
"Kansas":{abbr:"KS",rank:29,prob:37.86},"New Jersey":{abbr:"NJ",rank:30,prob:34.83},
"Ohio":{abbr:"OH",rank:31,prob:34.47},"Nevada":{abbr:"NV",rank:32,prob:34.39},
"New Mexico":{abbr:"NM",rank:33,prob:34.37},"North Carolina":{abbr:"NC",rank:34,prob:33.35},
"Delaware":{abbr:"DE",rank:35,prob:32.84},"Arizona":{abbr:"AZ",rank:36,prob:32.76},
"Missouri":{abbr:"MO",rank:37,prob:30.68},"Indiana":{abbr:"IN",rank:38,prob:30.3},
"Georgia":{abbr:"GA",rank:39,prob:26.24},"Texas":{abbr:"TX",rank:40,prob:25.54},
"South Carolina":{abbr:"SC",rank:41,prob:24.62},"Tennessee":{abbr:"TN",rank:42,prob:24.4},
"Oklahoma":{abbr:"OK",rank:43,prob:23.94},"Florida":{abbr:"FL",rank:44,prob:22.43},
"West Virginia":{abbr:"WV",rank:45,prob:20.95},"Arkansas":{abbr:"AR",rank:46,prob:19.57},
"Alabama":{abbr:"AL",rank:47,prob:19.17},"Kentucky":{abbr:"KY",rank:48,prob:17.72},
"Louisiana":{abbr:"LA",rank:49,prob:17.35},"Mississippi":{abbr:"MS",rank:50,prob:15.65}
};

const css=getComputedStyle(document.documentElement);
const hard0=css.getPropertyValue("--hard0").trim();
const hard1=css.getPropertyValue("--hard1").trim();
const easy0=css.getPropertyValue("--easy0").trim();
const easy1=css.getPropertyValue("--easy1").trim();

const probs = Object.values(dryData).map(d=>d.prob).sort((a,b)=>a-b);
const min = d3.min(probs), max = d3.max(probs), mid = d3.median(probs);

/* Diverging scale:
   - below median: hard0 -> hard1 (blue gets stronger as it gets "harder")
   - above median: easy0 -> easy1 (orange gets stronger as it gets "easier")
   We map probability so that low prob = blue, high prob = orange.
*/
function diverge(t){
  if (t <= 0.5){
    // left side (harder) should get darker blue as t approaches 0 (hardest).
    // so invert within the half: 0 -> hard1, 0.5 -> hard0
    return d3.interpolateRgb(hard1, hard0)(t/0.5);
  }
  // right side (easier): 0.5 -> easy0, 1 -> easy1
  return d3.interpolateRgb(easy0, easy1)((t-0.5)/0.5);
}
const color = d3.scaleDiverging(diverge).domain([min, mid, max]);

/* Tooltip helpers */
const tooltip = d3.select("#tt");
function esc(s){
  return String(s).replace(/[&<>"']/g, c => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[c]));
}
function placeTooltip(event){
  const rect = tooltip.node().getBoundingClientRect();
  const pad = 10;
  let x = event.pageX + 12;
  let y = event.pageY + 12;
  if (x + rect.width > window.innerWidth - pad) x = window.innerWidth - rect.width - pad;
  if (y + rect.height > window.innerHeight - pad) y = window.innerHeight - rect.height - pad;
  tooltip.style("left", x+"px").style("top", y+"px");
}
function showTip(event, stateName, d){
  tooltip
    .style("display","block")
    .html(
      `<strong>${esc(stateName)} (${d.abbr})</strong>
       <div class="mono">Rank ${d.rank} • ${Math.round(d.prob)}% estimated chance</div>
       <div class="muted">Higher = easier to finish</div>`
    );
  placeTooltip(event);
}
function hideTip(){ tooltip.style("display","none"); }

/* Build ranking list (no %), clickable */
const rows = Object.entries(dryData)
  .map(([state, v]) => ({ state, ...v }))
  .sort((a,b)=>a.rank-b.rank);

const rankcols = document.getElementById("rankcols");
rankcols.innerHTML = rows.map(r => `
  <div class="rankrow" data-state="${esc(r.state)}" title="Rank ${r.rank}: ${esc(r.state)}">
    <span class="rdot" style="background:${color(r.prob)}"></span>
    <span class="rnum">${r.rank}</span>
    <span class="rname">${esc(r.state)}</span>
  </div>
`).join("");

/* Draw map */
const svg = d3.select("#map");
const W = 975, H = 610;
const projection = d3.geoAlbersUsa().scale(1300).translate([W/2, H/2]);
const geoPath = d3.geoPath(projection);

let statePaths; // for highlighting

d3.json("https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json").then(us => {
  const states = topojson.feature(us, us.objects.states).features;

  statePaths = svg.selectAll("path.state")
    .data(states)
    .join("path")
    .attr("class","state")
    .attr("d", geoPath)
    .attr("data-name", d => d.properties && d.properties.name)
    .attr("fill", d => {
      const name = d.properties && d.properties.name;
      const data = dryData[name];
      return data ? color(data.prob) : "#eee";
    })
    .on("mousemove", (event, d) => {
      const name = d.properties && d.properties.name;
      const data = dryData[name];
      if(!data) return hideTip();
      showTip(event, name, data);
    })
    .on("mouseout", hideTip)
    .on("click", (event, d) => {
      const name = d.properties && d.properties.name;
      const data = dryData[name];
      if(!data) return hideTip();
      showTip(event, name, data);
      highlightState(name);
      event.stopPropagation();
    });

  svg.append("path")
    .datum(topojson.mesh(us, us.objects.states, (a,b)=>a!==b))
    .attr("class","state-outline")
    .attr("d", geoPath);

  document.addEventListener("click", () => { hideTip(); clearHighlight(); });
  document.addEventListener("keydown", (e)=>{ if(e.key==="Escape"){ hideTip(); clearHighlight(); }});
});

/* Highlight logic */
function clearHighlight(){
  if(!statePaths) return;
  statePaths
    .attr("opacity", 1)
    .attr("stroke-width", 6)
    .attr("stroke", "#fff");
  document.querySelectorAll(".rankrow").forEach(r => r.style.opacity = "1");
}

function highlightState(name){
  if(!statePaths) return;

  statePaths
    .attr("opacity", d => (d.properties.name === name ? 1 : 0.35))
    .attr("stroke", d => (d.properties.name === name ? "rgba(11,34,53,0.9)" : "#fff"))
    .attr("stroke-width", d => (d.properties.name === name ? 7 : 6));

  document.querySelectorAll(".rankrow").forEach(r => {
    r.style.opacity = (r.getAttribute("data-state") === name ? "1" : "0.35");
  });
}

/* Click rank rows to highlight map */
rankcols.addEventListener("click", (e) => {
  const row = e.target.closest(".rankrow");
  if(!row) return;
  const name = row.getAttribute("data-state");
  if(!name) return;

  // find data for tooltip
  const d = dryData[name];
  if(d){
    // fake a tooltip near center-ish (since it's a click in list)
    const evt = { pageX: window.innerWidth/2, pageY: window.scrollY + 220 };
    showTip(evt, name, d);
  }
  highlightState(name);
  e.stopPropagation();
});
</script>
</body>
</html>
